using System;
using System.Collections.Generic;
using System.Text;
using Xamarin.Forms;

namespace AMIMobile
{
    public partial class ChartLine : ContentPage
    {
        public ChartLine()
        {
            InitializeComponent();
            var browser = new WebView();
            var htmlSource = new HtmlWebViewSource();
            StringBuilder htmlStr = new StringBuilder("");

            htmlStr.Append("<style>\n#chartdiv {\n  width: 100%;\n  height: 500px;\n}\n</style>\n\n<!-- Resources -->\n<script src=\"https://cdn.amcharts.com/lib/5/index.js\"></script>\n<script src=\"https://cdn.amcharts.com/lib/5/xy.js\"></script>\n<script src=\"https://cdn.amcharts.com/lib/5/themes/Animated.js\"></script>\n\n<!-- Chart code -->\n<script>\nam5.ready(function() {\n\n// Create root element\n// https://www.amcharts.com/docs/v5/getting-started/#Root_element\nvar root = am5.Root.new(\"chartdiv\");\n\n// Set themes\n// https://www.amcharts.com/docs/v5/concepts/themes/\nroot.setThemes([\n  am5themes_Animated.new(root)\n]);\n\n// Create chart\n// https://www.amcharts.com/docs/v5/charts/xy-chart/\nvar chart = root.container.children.push(am5xy.XYChart.new(root, {\n  panX: true,\n  panY: true,\n  wheelX: \"panX\",\n  wheelY: \"zoomX\",\n  pinchZoomX:true\n}));\nchart.set(\"scrollbarX\", am5.Scrollbar.new(root, {\n  orientation: \"horizontal\"\n}));\n\n// Create axes\n// https://www.amcharts.com/docs/v5/charts/xy-chart/axes/\nvar xRenderer = am5xy.AxisRendererX.new(root, {});\nxRenderer.grid.template.set(\"forceHidden\", true);\nxRenderer.labels.template.setAll({multiLocation: 0, location:0});\n\nvar xAxis = chart.xAxes.push(am5xy.DateAxis.new(root, {\n  baseInterval: { timeUnit: \"minute\", count: 30 },\n  renderer: xRenderer,\n  tooltip: am5.Tooltip.new(root, {}),\n  extraMin: 0.01,\n  extraMax: 0.01,\n  tooltipLocation: 0\n}));\n\nvar yRenderer = am5xy.AxisRendererY.new(root, {});\nyRenderer.grid.template.set(\"forceHidden\", true);\n\nvar yAxis = chart.yAxes.push(am5xy.ValueAxis.new(root, {\n  renderer: yRenderer\n}));\n\n// Add cursor\n// https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/\nvar cursor = chart.set(\"cursor\", am5xy.XYCursor.new(root, {\n  behavior: \"none\",\n  xAxis: xAxis\n}));\ncursor.lineY.set(\"visible\", false);\n\n// Add series\n// https://www.amcharts.com/docs/v5/charts/xy-chart/series/\nvar series = chart.series.push(am5xy.LineSeries.new(root, {\n  name: \"Series\",\n  xAxis: xAxis,\n  yAxis: yAxis,\n  valueYField: \"value\",\n  valueXField: \"timestamp\",\n  locationX: 0,\n  seriesTooltipTarget: \"bullet\",\n  tooltip: am5.Tooltip.new(root, {\n    labelText: \"{valueY}\"\n  })\n}));\n\nseries.bullets.push(function() {\n  var circleTemplate = am5.Template.new({\n    radius: 6,\n    templateField: \"bulletSettings\",\n    fill: series.get(\"fill\"),\n    strokeWidth: 2,\n    stroke: root.interfaceColors.get(\"background\")\n  })\n\n  var circle = am5.Circle.new(root, {}, circleTemplate);\n\n  return am5.Bullet.new(root, {\n    sprite: circle,\n    locationX: 0\n  });\n});\n\nfunction createGuide(value, text, dashArray) {\n  var guideDataItem = yAxis.makeDataItem({ value: value });\n  yAxis.createAxisRange(guideDataItem);\n  guideDataItem.get(\"grid\").setAll({\n    forceHidden: false,\n    strokeOpacity: 0.2,\n    strokeDasharray: dashArray\n  });\n\n  var label = guideDataItem.get(\"label\");\n  label.setAll({\n    text: text,\n    isMeasured: false,\n    centerY: am5.p100\n  });\n\n  label.adapters.add(\"x\", function(x) {\n    return chart.plotContainer.width();\n  })\n  \n  chart.events.on(\"boundschanged\", function(){\n    label.set(\"x\", label.get(\"x\"))\n  })  \n}\n\n\ncreateGuide(98.8, \"LCL\", [2, 2]);\ncreateGuide(100.1, \"CL\");\ncreateGuide(101.2, \"UCL\", [2, 2]);\n\n\nvar data = [{\n  \"timestamp\": new Date(2020, 0, 1, 22, 30).getTime(),\n  \"value\": 99.71\n}, {\n  \"timestamp\": new Date(2020, 0, 1, 23, 0).getTime(),\n  \"value\": 99.13\n}, {\n  \"timestamp\": new Date(2020, 0, 1, 23, 30).getTime(),\n  \"value\": 98.5\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 0, 0).getTime(),\n  \"value\": 101\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 0, 30).getTime(),\n  \"value\": 99.45\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 1, 0).getTime(),\n  \"value\": 100.9\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 1, 30).getTime(),\n  \"value\": 100.39\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 2, 0).getTime(),\n  \"value\": 101.1\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 2, 30).getTime(),\n  \"value\": 101.45\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 3, 0).getTime(),\n  \"value\": 101.15\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 3, 30).getTime(),\n  \"value\": 100.5\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 4, 0).getTime(),\n  \"value\": 101.55,\n  \"bulletSettings\": { fill: am5.color(\"#f0c803\") }\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 4, 30).getTime(),\n  \"value\": 101.7,\n  \"bulletSettings\": { fill: am5.color(\"#970505\") }\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 5, 0).getTime(),\n  \"value\": 100.5,\n  \"bulletSettings\": { fill: am5.color(\"#f0c803\") }\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 5, 30).getTime(),\n  \"value\": 100.92,\n  \"bulletSettings\": { fill: am5.color(\"#f0c803\") }\n}, {\n  \"timestamp\": new Date(2020, 0, 2, 6, 0).getTime(),\n  \"value\": 102.2,\n  \"bulletSettings\": { fill: am5.color(\"#970505\") }\n}];\n\nseries.data.setAll(data);\n\n// Make stuff animate on load\n// https://www.amcharts.com/docs/v5/concepts/animations/\nseries.appear(1000);\nchart.appear(1000, 100);\n\n}); // end am5.ready()\n</script>\n\n<!-- HTML -->\n<div id=\"chartdiv\"></div>\n\n");
            htmlSource.Html = htmlStr.ToString();
            browser.Source = htmlSource;
            Content = browser;
        }
    }
}

